---
title:  因子投资
layout: post
categories: 量化
tags: 量化 因子投资
excerpt: 因子投资：方法与实践【一本真正可操作、可上手的因子投资手册！】
---

# 第1章 因子投资基础


## 1.1 统一视角下的因子投资


### 1.1.1 一个公式

$E[R_i] - R_f = β_i(E[R_M]R_f)$ (1.1)

- $E[R_i]$
期望
- $R_i$
为某资产i的收益率
- $R_f$
为无风险收益率，
- $R_M$
为市场组合的预期收益率。
- $β_i=cov(R_i,R_M)/var(R_M)$
刻画了该资产收益对市场收益的敏感程度，它也被称为资产i对市场风险的暴露程度。

CAPM正是最简单的线性因子模型，它指出资产的预期超额收益率由市场组合的预期超额收益率和资产对市场风险的暴露大小决定，而市场组合也被称为市场因子。

Ross(1976)提出了著名的套利定价理论(Arbitrage Pricing Theory，APT)


$E[R_i^e] = β'_iλ$ (1.2)

- $E[R_i^e]$
资产i的预期超额收益,此约定俗成在称呼上舍去“超额”二字而仅用预期收益率。
- $β'_i$
资产i的因子暴露(factor exposure)或称因子载荷(factor loading)
- $λ$
因子预期收益(factorexpectedreturn)，也常被称为因子溢价(factorriskpremium)[2]。

式(1.2)中引入符号代表预期超额收益而舍弃了$E[R_i] - R_f$。

对于个股或者由若干支股票组成的纯多头投资组合这类资产，它的预期超额收益是$E[R_i]$和无风险收益率$R_f$之差，即$(E[R_i] - R_f)$
在实证资产定价中，另一类常见的资产是通过多空对冲构建的资金中性投资组合，例如做多一定金额的股票，同时做空同样金额的股票。依照定义，这类资产的预期超额收益率就是多头和空头预期收益之差，无须额外减去无风险收益率。因此，使用代表资产的预期超额收益更具一般性。

在多因子模型研究的术语中，不同资产预期收益率的差异通常被称为(横)截面(cross-sectional)差异，给定因子的预期收益率，资产预期收益率的高低由它在这些因子上的暴露$β'_i$大小决定。

$E[R_i^e] = α_i + β'_iλ$ (1.3)

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220910093851.png)

$α_i$就是资产i的实际预期收益率和多因子模型隐含的预期收益率之间的定价误差

该误差产生的原因可以从以下两方面来考虑：
(1)模型设定偏误，即式(1.2)右侧遗漏了重要的因子。当被遗漏的因子被加入后，即可消除误差。  
(2)模型本身没有问题，但由于资产收益率的实际数据仅仅是总体的一个样本，因此误差总是存在的。这时需要通过统计方法检验误差$α_i$是否显著不为零：  
- 如果$α_i$并非显著的偏离零，那么可以认为它的出现仅仅是因为运气的原因；
- 如果$α_i$**显著偏离零**，它则代表了**某个可以通过套利而获得超额收益的机会**[3]；它也同时说明由于某些原因，市场对该资产出现错误定价(mispricing)，从而导致其实际预期收益率和多因子模型下的预期收益率出现了偏离。

如何选择因子来构建多因子模型，如何计算资产在因子上的暴露以及因子的收益率，如何使用统计学的方法对定价误差$α_i$进行正式检验就成了使用多因子模型研究资产定价时必须回答的问题。

### 1.1.2 因子、多因子模型和异象
$β'_iλ$中包含了多个影响式(1.3)左侧资产收益率的解释变量，每个解释变量代表了一个因子。

多个因子的预期收益率以及资产在它们上的暴露放在一起构成的就是多因子模型, $β'_iλ$这个整体是多因子模型， 每个解释变量$β'_i$代表一个因子。对于某个给定的资产i，如果它的实际预期收益率和多因子模型隐含的预期收益率之间的误差$α_i$显著不为零，则称这个资产为一个异象(anomaly)。

> **因子的定义**： 一个因子描述了众多资产共同暴露的某种系统性风险，该风险是资产收益率背后的驱动力；因子收益率正是这种系统性风险的风险溢价或风险补偿，它是这些资产的共性收益。

Ang(2014)将因子之于资产类比于营养之于食物。人们的日常生活离不开摄入各种食物，比如米饭、谷物、肉类和乳制品等。这些食物之所以对人体重要是因为它们所包含的营养成分，例如水、碳水化合物、蛋白质、纤维和脂肪等。这些营养成分就是食物的“因子”。每种食物对人体的价值体现在两方面：
(1)它包含哪些营养成分以及包含了多少(类比多因子模型中的$β'_i$)；  
(2)该食品包含的每种营养成分对人体健康的重要性(类比多因子模型中的$λ$)。  
因此，虽然食物种类五花八门，但归根结底它们都可以归结为不同营养成分的组合；同理，虽然股票资产的组合形式成百上千，但归根结底它们都可以归结为不同因子的组合。这就是因子的作用和多因子模型的价值。

从上述定义可以总结出因子需要满足的两个必要条件：
(1)因子驱动了资产收益率的共同运动(comovement)，因此因子一定和资产收益率的协方差矩阵有关；  
(2)从长期来看因子是可以获得正收益的，这意味着因子必须是被定价的。明确了因子的定义，下面再来看看什么是多因子模型。  

如何确定一个多因子模型中到底有几个以及哪些因子，可以从以下两点考虑。
- 加入模型的因子是相互独立的
首先，很多因子之间都存在一定的相关性，高度相关的因子代表的是资产收益率所暴露的同一类风险。在选择模型包括的因子时，必须要考虑相关性的影响，人们希望加入模型的因子是相互独立的、每个因子都能对解释资产预期收益率截面差异有显著的增量贡献。
- 考虑简约法则(The Law of Parsimony)
学术界的主流多因子模型通常包括3～5个因子，本书的第4章将对这些模型进行系统的阐述。  


### 1.1.3 再论异象和因子
$β'_iλ$是一个定价模型，因此它包含的因子又被称为定价因子(pricing factors)；而$α_i$代表的是按某种方法构建出的能够获得多因子模型无法解释的超额收益的资产，因此它又被称为异象因子(anomaly factors)。

### 1.1.4 因子投资包含的内容
- 关注于$β'_i$的研究
学术界关注的是找到“最好”的多因子模型。“最好”通常意味着在该模型下资产的$α_i$尽可能接近零，即该模型无法解释的异象越少越好。大量的实证数据研究表明，在选择了适当的多因子模型后，绝大多数主动基金管理人并不能获得超额收益。

业界进行因子投资最重要的目标是使用因子来获取超过基准的收益。因此业界从资产配置的角度聚焦于找到从长期来看有风险溢价的因子(即$λ$大)，并以尽可能高的暴露(即$β'_i$高)配置在这些因子上

------

- 关注于$α_i$的研究
$α_i$代表了可以通过套利获得的超额收益。

先说学术界，从有效市场假说(Efficient Market Hypothesis，出自Fama 1970)的观点出发，如果多因子模型不存在模型设定偏误，那么市场中不应该存在太多异象。

**解释异象的能力是评价多因子模型优劣的重要标准之一**。比如两个多因子模型A和B，如果使用模型A时异象的个数少于使用模型B时异象的个数，就会认为模型A比模型B更好。模型之间的对比也从侧面推动了对异象的研究。

业界并不严格区分定价因子和异象因子。在业界看来，一个因子是否被纳入某个定价模型(从而从异象因子转变为定价因子)并不重要，而更关心在考虑了交易成本之后，使用该因子是否仍然能够获得超额收益。

------


- 截面角度vs时序角度
从数学定义可知，预期收益率是收益率在时间序列上的平均，因此均值的模型仅关心不同资产的收益率均值为什么会有差异，而非每个资产的收益率如何随时间变化。把式(1.3)沿时间轴展开，资产超额收益和因子收益率在时序上满足如下多元线性回归模型：

$$
\begin{aligned}
E[R_{it}^e] = α_i + β'_iλ_t + ξ_{it} (1.4)
\end{aligned}
$$

- $E[R_{it}^e]$
表示t时刻资产i的超额收益
- $λ_t$
表示t时刻因子收益率
- $ξ_{it}$
表示t时刻的随机扰动

这就是研究多因子模型的时间角度。图1.2展示了截面角度和时序角度之间的切换。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220824115617.png)

随机扰动随着时间回归之后$E(ξ_{it})=0$

$$
\begin{aligned}
R_{t}^e &= α + βλ_t + ξ_{t} (1.5) \\
N维超额收益向量：R_{t}^e &= [R_{1t}^e, R_{2t}^e, ..., R_{Nt}^e]' \\
N维定价误差向量 ：α &= [α_{1}, α_{2}, ..., α_{N}]' \\
N*K因子暴露矩阵 ：β &= [β_{1}, β_{2}, ..., β_{N}]' \\
N维随机扰动因子 ： ξ_{t} &= [ξ_{1t}, ξ_{2t}, ..., ξ_{Nt}]' \\
\end{aligned} 
$$

这里的K指的是因子数量，N是资产数量，参考投资科学中多因子模型中的推导。

考虑多因子模型以及均衡状态的状态：

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220906195025.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220909084458.png)

对式(1.5)两侧求协方差矩阵

简单的情况：

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220906195025.png)

$$
\begin{aligned}
由cov(λ_t,ε_t)&=0可得 \\
Σ&=βΣ_λβ'+Σ_ε　(1.6) \\
Σ(N阶矩阵)&= N个资产的协方差矩阵 \\
Σ_λ(K阶矩阵)&= K个因子的协方差矩阵 \\
Σ_ε(N阶矩阵)&= N个随机扰动的协方差矩阵 \\
由于ε_{it}相互独立，因此Σε是一个对角阵。
\end{aligned} 
$$

式（1.6）就是关于方差的模型。

在多因子模型中，因子的个数K往往远小于资产的个数，因此使用多因子模型分析资产收益率相当于一种降维处理。式（1.6）通过多因子模型把求解N阶的协方差矩阵巧妙地转化为求解K阶因子收益率的协方差矩阵。有了因子协方差矩阵，利用资产和因子收益率之间的线性关系就可以反推出资产收益率的协方差矩阵并进行风险控制，这种做法在投资实务中有巨大的价值。

由于业界使用因子的目的是进行资产配置和获取超额收益，因此自然会对因子收益率在时序上的变化产生极大的兴趣。这是因为如果能够通过择时来挑出某个因子“好使”的时候配置、在它“不好使”的时候规避，那么无疑会提高使用因子的风险收益水平。正是在这个动机的趋势下，**因子择时**始终是业界的研究热点之一。


![图1.3统一视角下的因子投资](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911100734.png)
图1.3 统一视角下的因子投资

## 1.3　因子投资的业界发展

### 1.3.1　因子投资和管理人
当管理人实施因子投资时，往往可以从以下几个角度考虑：
- （1）收益预测vs风险管理；
- （2）资金流入削弱因子收益率；
- （3）因子择时；
在因子择时的众多方法中，最重要的两类方法是按因子估值（factor valuation）和按因子动量（factor momentum）择时两大立场。这两个立场来自美国两个著名且风格鲜明的对冲基金。前者的拥趸是来自美国西海岸的ResearchAffiliates，而后者的支持者是来自美国东海岸的AQR。
- （4）各类因子大行其道，如何鉴别能够获得超额收益的管理人；
从多因子模型的定义以及式（1.3）中的数学符号可知，某个资产的高收益既可能来自高α也可能来自选择了收益率高的因子并且以高暴露（即高β）配置在这些因子上，因此业界（和学术界）通常把这两部分收益称为α和β收益。

- （5）创新的价值。

### 1.3.2　因子投资和投资者
1987年罗素（RussellInvestments）推出了最早的两个风格指数，分别对标价值和成长因子。在这之后，标准普尔指数公司（S&P）[2]、明晟（MSCI）等机构也推出了它们各自的风格指数。最初，推出这些指数的目的是评估主动基金经理人的业绩。然而不久之后，复制这些指数的基金便应运而生。

针对某个因子的不同ETFs，一般可以从因子敞口、费用、流动性等角度进行比较。即便表1.1中所列出ETFs都是为了捕捉价值因子的超额收益，但它们的风格差异却十分鲜明。这无疑对投资者的选择带来了巨大的挑战。

## 1.4 本书结构
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911104259.png)

# 第2章 因子投资方法论
## 2.1　投资组合排序法
像估值、GDP这些都可以作为因子来解释股票的收益率，但是**如何定量计算它们的收益率**呢？为了回答问题，就要用到实证资产定价和因子投资中的一个非常重要的概念——因子模拟投资组合（factor mimicking portfolio）。如果说因子是抽象的，那么因子模拟投资组合就是这个抽象概念的实际载体，它是定量研究和使用因子的出发点。

### 2.1.1　因子模拟投资组合

因子模拟投资组合是使用股票资产、围绕某目标因子构建的投资组合；该投资组合需满足以下两个条件：
- 条件一：该投资组合仅在目标因子上有大于零的暴露、在其他因子上的暴露为零；
- 条件二：在所有满足条件一的投资组合中，该投资组合的特质性风险（idiosyncratic risk）最小。

举例说明如下：
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911105606.png)
按照第一个条件，可以选择按同等资金权重配置股票一和股票三。由于它们在因子B上的暴露取值相反，因此这二者构成的投资组合仅在因子A上有暴露。
按照第二个条件，在股票一和股票三、股票一和股票四这两个组合中，由表中数据可知，后者的特质性风险要低于前者。因此，根据因子模拟组合需满足的两个条件，最终可通过等权重配置股票一和股票四构建了因子A的因子模拟投资组合。

### 2.1.2　排序法及其检验
排序法用于**计算因子模拟组合的收益率**，排序法最大的优势则在于它舍弃了“因子暴露已知”这个条件，从而绕过了上述“怪圈”。

下面以账面市值比（book-to-market ratio，BM，即市净率的倒数）这个经典的估值指标为例介绍排序法的**核心思想**。虽然BM是一个估值指标，但依照学术界的惯例，将通过它构建的因子称为价值因子而非估值因子。本书遵循上述惯例。在排序法中，将股票排序的变量（比如BM）被称为排序变量（sort variable，简称变量）。排序法中最核心的思想是使用个股在该变量上取值的大小来代替个股在该因子上暴露的高低。。以BM为例，该方法认为高BM的股票在围绕BM构建的价值因子上的暴露更高，低BM的股票在围绕BM构建的价值因子上的暴露更低，仅此而已。这也解释了排序法为什么仅适用于风格因子。对于其他类型的因子（比如宏观经济因子），由于难以从个股本身的数据出发找到和因子暴露相关的变量，自然也就无法使用这种方法。

**具体方法**：
- 按变量将股票排序
确定股票池，并将股票池中的全部股票在截面上按照排序变量（本例中的BM）的取值高低从大到小排序
- 把股票依排序分组构建投资组合
按排名高低将全部股票分为L组（依照惯例，一般根据变量取值分布的十分位数将全部股票分成10组，即L=10）。做多排名最高的第一组内的股票，并同时做空排名最低的最后一组内的股票而构建一个多、空对冲的投资组合，该投资组合又被称为价差组合（spread portfolio）。由构建方式可知，价差组合中多、空两头的收益率分别为变量取值最高的1/L股票的收益和变量取值最低的1/L股票的收益，它们的差异就反映了围绕该变量构建的因子的收益率。

- 以及定期更新投资组合
学术界通常称上述更新为再平衡（rebalance），且再平衡的频率多为每月或每年。在每期构建了新的因子模拟投资组合之后，计算该组合在当前时刻和下一个再平衡时刻之间的收益率。在时序上如此往复，就得到因子收益率的时间序列。

**投资组合排序检验**：

投资组合排序检验最重要的目的是检验因子预期收益率。

得到`λ`的时间序列后，可以按照如下公式进行计算：
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220919210334.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220919210349.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220919210403.png)

其中2.3的`t-值`满足自由度为T1的t分布。根据t值和t分布可计算出（双尾）p值，通过t值或p值就能够判定在给定的显著性水平下接受或拒绝原假设。依照学术界的惯例，通常使用`0.05`和`0.01`的显著性水平，在大样本下它们对应的t值阈值分别约为`2.0`和`2.6`。因此，一旦样本数据计算出的收益率的t值高于`2.0`，就认为该结果在原假设下是显著的[3]。如果原假设（因子预期收益率为零）无法被拒绝，那么被研究的因子就不满足预期收益率大于零的要求，因此t值是否高于`2.0`就是一个重要的判定依据[4]。

排序法关注的第二个问题就是依照排序变量高低得到的L个投资组合的收益率是否有很好的单调性，这可以通过计算收益率和排序变量分组的秩相关系数（rankcorrelationcoefficient）来检验，见式2.4。以BM排序为例，图形化后如下所示：

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911115329.png)


排序法仅仅是构建因子模拟投资组合的一个相对“粗暴”的方法。根据定义，因子模拟投资组合应该在非目标因子上没有暴露，然而排序法却难以控制其他因子的影响，这是它最大的缺点。举个假想的例子，如果高BM的股票全都是大市值股票、低BM的股票全都是小市值股票，那么当使用BM这个单一变量排序的时候，构建的价差组合在无形之中也同时做多了大市值股票、做空了小市值股票。因此，这个价差组合虽然是围绕BM构建的，但其收益率却受到BM和市值的共同影响，因而难以客观评估BM的贡献。为了尽可能排除其他因子的干扰，常见的做法是使用多个变量进行双重排序或三重排序，这些方法统称为多重排序法。


### 2.1.3 多重排序法
1. 双重排序
使用双重排序的目的是排除两个变量之间的相互影响，从而更准确地计算围绕每个变量构建的因子模拟投资组合的收益率。

- 独立双重排序：使用这两个变量分别独立对股票排序

假设使用两个排序变量分别独立地把股票划分成5组，即L1=L2=5，它们两两取交集一共得到25个投资组合，如图2.2中的P11到P55所示。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911190931.png)

分析$X_1$和$X_2$对应因子的收益率，如下：

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911192121.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911192212.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911192228.png)


在学术界针对美股市场异象的研究中，双重排序法经常被使用。为了检验一个新的异象变量可以获得超额收益，学者们往往用它和已有的因子变量进行双重排序，从而排除已有因子的影响。在进行分析时，学者们除了关心异象收益率之外，还关心在已有因子变量的每组内，该异象变量是否能区分股票收益率的截面差异。回到上面X1和X2的例子，为检验能否通过X1构建异象，应考察在每个X2分组内，根据X1划分的L1个分组中最高和最低的组的收益率差异是否显著[7]。

人们通常不会使用截面相关性高的变量做双重排序。当对参与排序的两个变量的相关性不确定时，可以计算每组内股票的数量。如果全部L1×L2个投资组合均包含足够多的股票，那么就没有太大的问题。因为当X1和X2的截面相关性很高时，那么当一支股票在X1变量取值较高时，它在X2上的取值也会较高。这就会造成这两个变量相同的分组中——图2.2中对角线上的组——的股票个数较多。

例子可参考： [每日钱商——fama-french三因子模型](https://zhuanlan.zhihu.com/p/50411981)

- 条件双重排序：这两个变量在排序时存在先后的依存关系
仍然以X1和X2两个变量为例。假设先用X1排序将全部股票划分成L1组。接下来，在以上每个组内，再用X2排序把属于该组内的股票进一步划分为L2个组，最终得到L1×L2个分组。从这个例子中不难看出，条件双重排序是考察当X1控制之后，变量X2对股票收益率的影响。反之，如果按照先用X2排序、再用X1排序，那就是在考察控制了X2之后，变量X1对股票收益率的影响。

这种情况下计算收益可用如下方法：

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911193438.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911193503.png)

当每个投资组合中的股票都按照等权重配置时，式（2.6）和式（2.11）则是完全等价的。

### 2.1.4　因子命名约定
出于上述考量，本书选择以变量代表的风格为出发点对因子进行命名。举例来说，按照本书的约定，将会称使用BM构建的因子为价值因子，使用ROE构建的因子为盈利因子。

## 2.2　多因子模型的回归检验
多因子模型中最核心的问题是检验一系列因子解释异象的能力。本节就来说明如何使用回归的方法检验多因子模型，其中涉及的不同方法包括时序回归检验、截面回归检验以及Fama and MacBeth（1973）回归检验。

以单因子模型为例，当模型不能被完美地满足时，资产的预期收益率$E[R_i^e]λ$和模型算出的$β_iλ$之间就会存在误差，它就是图中的αi。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911195444.png)

拿来一个多因子模型，如何定量地评估它是否是一个好的模型呢？为了回答这个问题，首先来看检验中的三个部分：估计值（estimate）、标准误（standard errors）以及检验（test），见表2.3。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911195644.png)

对于$E[R_i^e] = α_i + β'_iλ$ 
$α_i$代表了资产i的定价误差。如果能够在统计上证明所有$α_i$都很接近零，则可以说该多因子模型就是很好的模型，即它能够解释资产预期收益率的截面差异。

多因子模型的回归检验可以简单总结为以下三步：
- （1）计算每个资产在所有因子上的暴露βi；
- （2）通过回归分析对多因子模型进行估计；
- （3）联合检验资产定价误差$α_i$以及每个因子的预期收益率$λ_k$。

### 2.2.1　时间序列回归
这种方法在回归时使用因子收益率作为自变量（independent variable）或解释变量（explanatory variable），以资产的超额收益率作为因变量（dependent variable）或被解释变量（explained variable）。

对每个资产i=1,2,···,N，使用简单最小二乘（Ordinary Least Squares，OLS）对模型（2.13）进行参数估计，得到资产超额回报的均值（2.14），时间序列回归中的截距$\hat{α_i}$正是资产i的定价误差的估计，其中$\hatλ$的说明如(2.15)所示。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911200535.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911200548.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911200558.png)

以单因子这种最简单的情况来画图，图2.4中所有黑色的实心圆点代表着资产，空心的点代表着因子投资组合。时间序列回归得到的多因子模型$E[R_i^e] = β_iλ$就是经过原点和空心点的那条直线。所有资产到这条直线的距离就是资产的$\hat{α_i}$。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220911200616.png)

下一步是计算各种参数的标准误，具体来说是检验$α_i$联合是否在统计上为零，可以使用经典的`GRS`方法。若（2.13）中的$ε_{it}$满足IID正态分布，则可以通过GRS方法构建F统计量来**检验$α_i$联合是否在统计上为零**，否则可以通过广义矩估计等更高级的方法；对于因子预期收益率，可使用t检验来分析。

时序回归方法总结如下：
- 1）因子收益率时序需已知。使用因子收益率作为解释变量，分别对每个资产进行时序回归，得到该资产在这些因子上的暴露的估计；时序回归中的（截距项）就是截面关系上资产的定价误差。
- 2）将时序回归结果在时间上取均值，就得到资产预期收益率和因子暴露在截面上的关系。由于时序回归是对每个资产单独进行的，因此该关系的确定不以最小化所有的平方和为目标。
- 3）若（2.13）中的$ε_{it}$满足IID正态分布，则可以通过GRS方法构建F统计量来检验αi联合是否在统计上为零，否则可以通过广义矩估计等更高级的方法；对于因子预期收益率，可使用t检验来分析。
![GRS方法](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220919211324.png)


### 2.2.2　截面回归
时间序列回归对诸如GDP、CPI以及利率这样的宏观经济因子无能为力。这时可以选择截面回归（cross-sectional regression）来检验多因子模型，它能够方便地处理因子收益率时序未知的情况。截面回归检验的最终目的自然还是考察和$E[R_i^e]$和$β_i$在截面上的关系。

其步骤为：

- （1）截面回归不要求因子的收益率时间序列已知，因此应用更加广泛。截面回归的第一步是通过时间序列回归得到每个资产i在因子上的暴露$\hatβ_i$(2.17)；第二步才是进行截面回归。因此这种方法又被称作两步回归估计（two-pass regression   estimate）。
在这里定义$f_t=[f_{1t}, f_{2t}, ..., f_{Kt}]'$ (K维阶向量)
- （2）在得到后，使用资产的时序平均收益率进行截面OLS或GLS回归，估计出因子的期望收益率$\hatλ$(2.20)和资产的定价误差$\hatα$(2.21)。
在这里定义全部N个资产在K个因子上的因子暴露矩阵$\hatβ=[\hatβ_{1}, \hatβ_{2}, ..., \hatβ_{K}]'$ (N*K矩阵)  
定义N维向量$\hatα=[\hatα_{1}, \hatα_{2}, ..., \hatα_{K}]'$  
定义N维向量$E_T[R^e] = [E_T[R_1^e], E_T[R_2^e], ..., E_T[R_N^e]]'$
- （3）由于$\hatβ_i$是估计值，因此在计算$\hatλ$和$\hatα$的标准误(2.22/2.23)时可以进行Shanken修正(2.24/2.25)。有了估计值和标准误，构建相应的`χ2-统计量`和`t-统计量`来进行检验。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220912074727.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220912074735.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220912074743.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220912074806.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220912074757.png)

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220920215809.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220920215918.png)

截面OLS回归中存在的另外一个问题是，在截面上$α_i$存在相关性。这种相关性虽然不会影响OLS估计的性质，但是会使OLS计算的标准误存在巨大的误差，造成对标准误的低估。为解决这个问题，可以使用广义最小二乘（Generalized Least Squares，即GLS）代替OLS。
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220920220420.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220920220438.png)

利用OLS或GLS得到的标准误，构建如下自由度为N-K的$χ_2$-检验统计量，检验全部N个定价误差是否联合为零:

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220920220449.png)

### 2.2.3　时序回归vs截面回归
对于风格因子这种可以通过排序法构建因子模拟投资组合并计算因子收益率时序的情况，既可以使用时序回归又可以使用截面回归来检验多因子模型。那么它们二者的区别是什么呢？

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921110422.png)

时序回归得到的曲线必然经过（ 0, 0） 和（ 1, λ） 两点。
反观截面回归，它的第一步和时序回归完全一样，也是使用已有的因子收益率作为解释变量，得到资产的**因子暴露**的估计。然而在第二步，它没有采用“时序上取平均”，而是以$\hatβ_i$为解释变量，以$E[R_i^e]$0为被解释变量进行截面回归。以OLS为例，它以最小化所有资产定价误差的平方和为目的。

关键问题：对于风格因子，它们的因子模拟投资组合明明已经有了，因子收益率时间序列也有了，只需要通过在时序上取平均就可以得到因子预期收益率，而截面回归却进行了第二步，通过OLS或GLS得到因子预期收益率。这两种方法得到的因子收益率是不同的，那么它们之间有什么差异？到底哪个是更准确的呢？

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921111326.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921111425.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921111436.png)

式(`2.23`)是`OLS`求得的因子预期收益率，考察$(\hatβ_i'\hatβ_i)^{-1}\hatβ_i'$这部分的含义。$\hatβ_i$是N×K因子暴露矩阵，因此前面这个表达式得到一个K×N矩阵，它的每一行对应一个因子，每一列对应一个资产。它的第k行可以被视作因子k的一个投资组合，第k行、第i列的数值即为资产i在该投资组合中的权重。因此，这个K×N矩阵恰好构成了多因子模型中全部因子的K个投资组合。

令$Ω = (\hatβ_i'\hatβ_i)^{-1}\hatβ_i'$， 式（`2.33`）展示出了矩阵Ω代表的因子投资组合的非常好的性质。对于任意一个因子k，它的投资组合中资产的权重是`Ω`的第`k`行。暴露。式（`2.34`）说明因子k的投资组合对任何其他因子j（j≠k）的暴露均为零；而式（`2.35`）则表明因子k的投资组合对它自己的暴露是1。以上就是式（`2.33`）的含义。使用截面回归不仅求出了每个因子的预期收益率，而且还同时得到了每个因子的投资组合。该投资组合满足只对该因子有暴露，而对其他因子没有暴露这个优秀的性质。


### 2.2.4　Fama–MacBeth回归
- 第一步：Fama–MacBeth回归的第一步也是通过N个时间序列回归得到每个资产i在全部因子上的暴露$\hatβ_i$，这和截面回归的第一步相同。Fama–MacBeth回归和截面回归检验最大的差异体现在第二步截面回归上。
- 第二步：截面回归检验使用$\hatβ_i$和$E[R_i^e]$在截面上进行一次截面回归。Fama–MacBeth回归在每个时间点t，以t期的收益率$E[R_i^e]$为因变量（注意：是t期的收益率，而非全部T期收益率的均值），以$\hatβ_i$为自变量进行截面回归，因而一共进行了T次截面回归。这是Fama–MacBeth回归检验和截面回归检验最大的不同。

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921113101.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921113113.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921113124.png)
- 第三步：求出每个因子预期收益率的标准误和每个资产定价误差的标准误
而在Fama–MacBeth截面回归得到了每个因子收益率的时间序列以及每个资产定价误差的时间序列，因此可以方便地求出每个因子预期收益率的标准误和每个资产定价误差的标准误，进而构造$\chi^2$-统计量**检验全部N个定价误差是否联合为零**：

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921125201.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921125218.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921125224.png)

简单来说，Fama–MacBeth截面回归是“先估计、再均值”，而传统截面回归是“先均值，再估计”，因此，Fama–MacBeth回归可以被理解为一种特殊的截面回归。

**评价**：
- 首先，它对于$α_{it}$在时序上的相关性无能为力，排除了$α_{it}$的截面相关性对标准误的影响
- 其次，由于截面回归中用到的$\hatβ_i$并不是真实的，而是通过时间序列得到的估计值，因此存在误差。

### 2.2.5　不同回归方法比较
当因子暴露$\hatβ_i$在时序上不变时，那么传统截面回归和Fama–MacBeth截面回归的结果是一致的。在应用中，可以通过比较不同检验方法的结果来加深对多因子模型的认知，这才是学习不同方法最大的价值。

## 2.3　因子暴露和因子收益率

问题的产生：
Fama–MacBeth回归中值得深入讨论的是如何确定因子暴露。由2.2.4的介绍可知，时序回归仅仅得到$β_i$的估计，它属于生成的回归变量，而非真实（但未知）的$β_i$。因此，这种做法存在误差。将$\hatβ_i$作为第二步截面回归中的解释变量就引入了**计量经济学**中的变量误差（errors-in-variables，EIV）问题。
> 参考： [第17 章金融模型中的变量误差问题](http://jrsyzx.njau.edu.cn/__local/0/7F/5E/43255BE886450E1795D88DEDD2D_F1675775_3543F.pdf?e=.pdf)

`EIV`问题的解法：
- 使用投资组合代替个股作为资产，将个股$β_i$的估计误差相互抵消。
如果待检验的因子和这些投资组合恰好正交，那么用它们作为资产进行Fama–MacBeth回归是无法发现这些因子的风险溢价的。
- 通过引入工具变量（instrumental variables，IV）的方法应对EIV问题。
- 直接采用公司特征（firmcharacteristic）的取值（经必要标准化处理后）作为因子暴露的估计$\hatβ_i$。

### 2.3.1　引入工具变量
> 参考：[工具變數 (instrumental variables)](https://www.youtube.com/watch?v=nRX25xECeO0)

![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921140842.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921140850.png)
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921140856.png)

由于模型（2.48）存在EIV问题，所以OLS估计量往往是有偏的（biased）。此外，由于多个解释变量同时存在，因此人们无法确定每个因子的收益率是被高估还是被低估，而式（2.49）所示的IV估计量则是因子收益率的**无偏估计**。


### 2.3.2　使用公司特征
![](https://suzixinblog.oss-cn-shenzhen.aliyuncs.com/20220921151742.png)

上述结果似乎在向人们传递这样的信息：比起时序回归的$\hatβ$，公司特征似乎才是更好的因子暴露。

### 2.3.3 两类模型

> 第 88 页 · 位置 1351

既然公司特征相比时序回归是更好的因子暴露，且只有以公司特征作为因子暴露代理变量的因子被定价，那么一个很自然的想法是使用截面回归计算因子收益率并以公司特征作为个股在因子上的暴露，从而也得到一种多因子模型。学术界管这种方法得到的模型叫作“截面多因子模型”。与之相对应的是自FamaandFrench（1993）沿袭而来的使用排序法计算因子收益率，并通过时序回归计算股票的因子暴露。这种模型被称为“时序多因子模型”。那么，在这两类模型中，谁能更好地解释股票预期收益率的截面差异呢？


> 第 89 页 · 位置 1363

截面回归多因子模型”优于“时序回归多因子模型”，原因可能源于两点：（1）截面回归的因子收益率优于排序法的因子收益率；（2）时变公司特征相比时序回归是更好的因子暴露代理变量。二者缺一不可。

## 2.4 异象检验

> 第 90 页 · 位置 1388

在股票多因子研究的范畴内，上述异象资产通常是按照如下几个步骤构造投资组合的：（1）选择一个潜在的财务指标或者量价指标，以它作为异象变量（anomalyvariable）。（2）根据异象变量取值的高低，将股票在截面上排序，使用排序法构建异象投资组合，并获得异象收益率的时间序列。（3）检验该异象收益率能否被多因子模型解释。

> 第 98 页 · 位置 1517

如果在控制了因子变量后，该异象的预期收益依然显著，那么就认为它可以获得多因子模型无法解释的超额收益。

## 2.5 多因子模型比较

> 第 101 页 · 位置 1552

要比较多因子模型，可以本着“两个目标、两个切入点、多种方法”这条逻辑主线进行。先看两个目标。

> 第 101 页 · 位置 1554

比较不同多因子模型对同一组测试资产的解释程度就是第一个目标；而不同多因子模型两两相互检验能否解释他人的因子就是第二个目标。

> 第 101 页 · 位置 1556

当评价一个多因子模型时，联合检验多个资产定价误差是否为零就是第一种切入点；而单独考察这些资产的定价误差是否为零则是另一种切入点。
第3章 主流因子解读
# 第3章 主流因子解读
## 3.1 数据和流程

> 第 167 页 · 位置 2571

剔除异常值的方法包括缩尾法（winsorization）、均值标准差法、中位数法和Boxplot法，其中缩尾法最简单也最常见。本书7.1.4节将简要介绍常见的剔除异常值方法。本书的实证中将采用左右各1%的缩尾处理，将小于1%分位数和大于99%分位数的样本点剔除。

## 3.2 市场因子

> 第 174 页 · 位置 2670

其一，市场组合的平均超额收益很高，但高、低β组合之间的收益差异要小很多，远远小于CAPM模型隐含的差异，这和BlackCAPM模型的结果相符。其二，诸多研究分别发现按照市值、账面市值比（booktomarketratio，BM）、盈利市值比（earningstopriceratio，EP）等变量有助于解释股票预期收益，这也进一步拒绝了CAPM模型。当然，从学科发展的角度来说，CAPM模型被实证证据拒绝也并非坏事，毕竟，正因如此才有了多因子模型和因子投资的兴起。FamaandFrench（2004）对此进行了很深入的综述和介绍。

> 第 174 页 · 位置 2677

实证研究发现资产预期收益和β之间的斜率远小于CAPM模型隐含的结果，而更加符合BlackCAPM模型。该结果也催生了一大类很重要的异象，即低β异象——通过做多低β的股票、同时做空高β的股票来获取超额收益。

## 3.4 价值因子

> 第 188 页 · 位置 2815

价值因子的含义简单而明确：相比估值较高的股票，那些估值较低的股票有着更高的预期收益率。

> 第 188 页 · 位置 2816

与规模因子一样，关于价值因子的研究也起自20世纪80年代，并由FamaandFrench（1993）这篇雄文发扬光大，而以账面市值比（BM）为变量构建的价值因子也正式确立为系统性的因子。

> 第 196 页 · 位置 2904

2019年，Liuetal.（2019）因为其是首个在金融学顶刊上发表的针对中国A股市场的多因子模型而备受关注。该文的两个特点是：（1）出于对A股市场壳价值污染的考虑，剔除了市值最低的30%的股票；（2）使用EP取代BM构建了价值因子。由本节的实证结果可知，BM在小市值中的作用要远远高于在大市值中的作用。因此剔除市值最低的30%的股票无疑会进一步削弱BM的显著性。

> 第 196 页 · 位置 2907

另一方面，从接下来3.6节关于盈利因子的实证可以看到，在A股中使用ROE为变量构建的盈利因子在小市值中的表现显著弱于其在大市值中的表现，因此剔除市值最低的30%的股票则在“无形中”提升了盈利因子的表现。

## 3.5 动量因子

> 第 198 页 · 位置 2935

动量因子背后反映的是股票间的相对强弱趋势会延续，“强者恒强，弱者恒弱”；通常通过做多过去一段时间表现最好的股票（称为赢家组合）、同时做空这段时间表现最差的股票（称为输家组合）来构建动量因子。

> 第 199 页 · 位置 2954

关于动量的成因，一部分学者将其归因于系统性风险敞口。具体来说，动态风险敞口假说认为赢家组合和输家组合有着不同的、时变的系统性风险暴露。因此，多空对冲构建的动量因子组合有着时变的系统性风险敞口，需要获得风险溢价补偿[

> 第 201 页 · 位置 2979

虽然有如此多的理论和实证支持动量效应，但仍有不少学者提出了质疑和批判。相关的问题主要包括三点，其一，有研究认为动量的收益其实来自对其他经典风险因子的暴露。例如，当控制了规模和低波动因子后，动量因子的超额收益在经济和统计意义上都大幅下降（Liu2019）。

> 第 201 页 · 位置 2989

残差动量（Blitzetal.2011）由个股的残差收益率计算，定义为个股收益率中无法被给定多因子模型解释的部分。Blitzetal.（2011）的研究发现残差动量可获得非常显著的收益，且不再有动量崩溃的烦恼。其背后的原因在于求解残差的过程剥离了传统动量因子对系统性风险因子的敞口，从而可以获得更加稳健的收益。

> 第 204 页 · 位置 3026

综合这两点可以看出，动量效应仅微弱地存在于A股的大市值股票中，而对于小市值的股票则更多地表现出反转。将五组平均后得到动量因子。

## 3.6 盈利因子

> 第 208 页 · 位置 3054

盈利能力指企业利用已有资源获取利润的能力。通常来说，盈利能力越强，企业前景越好，也越容易受到投资者的关注。经典的股票估值模型，不管股利贴现模型（DividendDiscountModel，DDM）还是剩余收益模型（ResidualIncomeModel，RIM），本质上都是把未来各期的盈利按照一定的折现率贴现到现在。

> 第 211 页 · 位置 3110

Asnessetal.（2019）定义的质量因子包括盈利、成长和安全性三个维度，盈利维度自不必说，而成长维度其实就是各种盈利增长变量。Frazzinietal.（2018）的实证结果显示，质量因子有助于解释巴菲特的长期优异表现，这也凸显了盈利因子的重要性。

> 第 215 页 · 位置 3149

回顾前文3.4.3节中关于价值因子的实证结果，与BM在大市值股票中的效果变差正好相反的是，ROE（TTM）在小市值股票中的效果更差。因此，在实证结果中如果因为某些原因剔除了小市值的股票，则会自然而然地提升ROE（TTM）的表现，同时削弱BM的表现，间接造成EP比BM构造的价值因子更加显著的结果。

## 3.7 投资因子

> 第 219 页 · 位置 3182

公司的最优投资行为要求公司投资预期盈利的现值等于投资的边际成本（此时边际利润为0）。在均衡时，盈利率除以投资的边际成本等于折现率，即股票的预期收益率。因此，在盈利率水平给定时，投资越高的公司，股票期望收益越低。

## 3.8 换手率因子

> 第 230 页 · 位置 3298

ChordiaandSwaminathan（2000）发现高成交股票的日度和周度收益率领先于低成交股票的。

> 第 230 页 · 位置 3300

而Subrahmanyam（2005）发现换手率对股票未来表现的影响存在显著的不对称性，对于过去一个月收益最低的股票，换手率同股票未来收益呈负相关，而对于过去一个月表现优异的股票，二者却呈正相关。

> 第 232 页 · 位置 3323

一些学者探讨了异常成交量对股票收益的影响，并发现异常高的成交量往往预示着更好的股票表现。例如，Gervaisetal.（2001）发现成交量异常高的股票有更高的未来收益，且成交量的预测能力并不受高成交量期间股票收益的影响，这同趋势交易方法的结论有所不同。

> 第 233 页 · 位置 3341

表3.30展示了以异常换手率为变量的排序检验结果。无论等权重还是市值加权，低换手率效应在A股上都十分显著，投资组合的收益率随着换手率的上升而下降。

# 第4章 多因子模型
> 第 239 页 · 位置 3387

由于排序法无法完全剔除因子间的相互影响，因此造成目标因子在其他因子上有不可避免的暴露，从而影响实证结果。第4.2节的Fama–MacBeth回归分析能够规避这一问题，给出更稳健的因子收益率分析结果。

> 第 240 页 · 位置 3394

从实证研究的角度，当多因子模型中加入越来越多的因子后，它总能更好地解释资产或异象的收益率，然而这么做却意义不大。优秀的多因子模型通常只因包含少量有限个因子[1]，且每个因子背后都应该有明确的金融学或经济学含义。

## 4.1 主流多因子模型综述

> 第 252 页 · 位置 3600

将净现值原则变化一下得出：折现率=盈利率/投资成本。从这个式子出发，可以得到两个关于折现率的条件预期结论：当盈利率给定时，投资越多的公司（投资成本越高），折现率越低，股票预期收益率也越低；当投资给定时，盈利率越高的公司，折现率越高，股票预期收益率也越高。由此可知，股票收益率和投资成反比，和盈利率成正比。

> 第 256 页 · 位置 3690

Stambaughetal.（2012,2014,2015）。他们以11个Fama–French三因子模型无法解释的异象为基础，构建了错误定价指标。其背后的逻辑是，异象的超额收益反映了其投资组合内股票的收益中无法被Fama–French三因子模型解释的超额收益，即个股的错误定价。因此，异象变量取值的高低就可以用来描述错误定价的方向（被高估或被低估）和大小。

> 第 261 页 · 位置 3761

这就是Danieletal.（2020）的研究动机。此外，该文进一步指出市场上的绝大多数异象可按照时间尺度分为短时间尺度和长时间尺度两大类。短时间尺度的异象大多来自投资者的有限注意力，而长时间尺度的异象大多来自投资者的过度自信。
为此Daniel等三位作者提出了捕捉长时间尺度异象的FIN因子和捕捉短时间尺度异象的PEAD因子。

## 4.2 A股中被定价的因子
### 4.2.1　Fama–MacBeth回归实证设定
