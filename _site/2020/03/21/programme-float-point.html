<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=gb2312" />
    <meta http-equiv="Content-Language" content="zh-CN" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- 360 -->
    <meta name="360-site-verification" content="fa6ca3a9a0330e9cecabee0a9fe1d52a" />
    <!-- 搜狗 -->
    <meta name="sogou_site_verification" content="oatSp9uAV5" />
    <!--熊掌号 -->
    <meta name="baidu-site-verification" content="Wkb0Jzk8yx" />
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="IJrXvaK-Luj-lCGP7tymcCbkcfMKi82Y8V21qN9ZT0s" />
    <title>
        
            关于浮点数的剪不断理还乱
        
    </title>
    <link rel="shortcut icon" type="image/x-icon" href="/assets/img/favicon.ico">
    
    <link rel="stylesheet" href="/assets/css/materialize.min.css">
    <link rel="stylesheet" href="/assets/css/icons.css">
    

    
        
        <link rel="stylesheet" href="/assets/css/page.css">
        
    
        
        <link rel="stylesheet" href="/assets/css/post.css">
        
    
        
        <link rel="stylesheet" href="/assets/css/syntax.css">
        
    
        
        <link rel="stylesheet" href="/assets/css/article-category.css">
        
    

    
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">	
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="关于浮点数的剪不断理还乱" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="展开介绍关于浮点的表示与转换原理" />
<meta property="og:description" content="展开介绍关于浮点的表示与转换原理" />
<link rel="canonical" href="http://localhost:4000/2020/03/21/programme-float-point" />
<meta property="og:url" content="http://localhost:4000/2020/03/21/programme-float-point" />
<meta property="og:site_name" content="苏梓鑫的博客" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-03-21T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="关于浮点数的剪不断理还乱" />
<script type="application/ld+json">
{"url":"http://localhost:4000/2020/03/21/programme-float-point","headline":"关于浮点数的剪不断理还乱","dateModified":"2020-03-21T00:00:00+08:00","datePublished":"2020-03-21T00:00:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2020/03/21/programme-float-point"},"description":"展开介绍关于浮点的表示与转换原理","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body>
    <header>
        <nav class="top-nav">
            
            <div class="nav-wrapper">
                <div class="container">
                    
                    <a class="page-title" href="/">苏梓鑫的博客</a>
                    <p class="head-message">学习&nbsp;&nbsp;总结&nbsp;&nbsp;分享&nbsp;&nbsp;提升</p>
                </div>
            </div>
        </nav>

        <div class="container">
            <a href="#" data-target="slide-out" class="sidenav-trigger top-nav full hide-on-large-only">
                <i class="material-icons">menu</i>
            </a>
        </div>
        <ul id="slide-out" class="sidenav sidenav-fixed" style="background-color:#ddd">
            <li>
                <div class="userView">
                    <img class="user-bg" src="/assets/img/bg.png" />
                    <a class="user-avatar" href="https://github.com/suzixin" target="_blank">
                        <img class="circle z-depth-2" src="/assets/img/user.png" width="64" />
                    </a>
                    <div class="white-text user-info">
                        苏梓鑫 <i>(Knight Huang)</i><br>
                        adahsuzixin@gmail.com
                    </div>
                </div>
            </li>
            <li><a class="waves-effect" href="/"><i class="material-icons">home</i>Home - 主页</a></li>
            <li><a class="waves-effect" href="/projects"><i class="material-icons">description</i>Github - 项目</a></li>
            <li><a class="waves-effect" href="/categories"><i class="material-icons">sort</i>Categories - 目录</a></li>
            <li><a class="waves-effect" href="/tags"><i class="material-icons">label</i>Tags - 标签</a></li>
            <li><a class="waves-effect" href="/feed.xml" target="_blank"><i class="material-icons">rss_feed</i>RSS - 订阅</a></li>
            <li><a class="waves-effect" href="/about"><i class="material-icons">person</i>About - 关于我</a></li>
            <li><a class="waves-effect" href="/contact"><i class="material-icons">email</i>Contact - 联系我</a></li>
            <!-- 华为云广告 -->
            <li class="ad">
                <!-- <a href="https://mp.weixin.qq.com/s/ujUoHc3grjO8LD_Bg1fckA" target="_blank"> -->
                <!-- <a href="https://mp.weixin.qq.com/s/MTbMlhjAx8R4fc8Po90EXg" target="_blank">
                    <img src="/assets/img/ad-huaweiyun.png" alt="" width="100%" />
                </a>
                <i class="material-icons" onclick="javascript:this.parentNode.style.display='none';">close</i> -->
            </li>
        </ul>
    </header>
    <main>

<div class="container">
    <div id="page-info">
        <h1 class="page-title white-text">关于浮点数的剪不断理还乱</h1>
    </div>
    <div id="page-content" class="row">
        <div id="post-info">
    <ul class="collapsible hoverable" data-collapsible="accordion">
        <li>
            <div class="collapsible-header grey lighten-4">
                <span>
                    <i class="material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Date">date_range</i>
                    21/03/2020 00:00<br />
                    <div id="busuanzi_container_site_pv">点击量：<span style="display: inline;" id="busuanzi_value_page_pv"></span>次</div>
                    <i id="indicate" class="right material-icons tooltipped" data-position="left" data-delay="30"
                        data-tooltip="Show extra info">info</i>
                </span>
            </div>
            <div class="collapsible-body">
                <span>
                    <i class="material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Categories">sort</i>
                    
                    
                    
                    <a href="/categories#编程_cap"
                        target="_blank">
                        <div class="chip">编程</div>
                    </a>
                    
                </span>
                <span>
                    <i class="material-icons tooltipped" data-position="left" data-delay="30" data-tooltip="Tags">label</i>
                    
                    
                    
                    <a href="/tags#浮点_cap" target="_blank">
                        <div class="chip">浮点</div>
                    </a>
                    
                    
                    
                    <a href="/tags#定点_cap" target="_blank">
                        <div class="chip">定点</div>
                    </a>
                    
                    
                    
                    <a href="/tags#二进制小数_cap" target="_blank">
                        <div class="chip">二进制小数</div>
                    </a>
                    
                    
                    
                    <a href="/tags#规约_cap" target="_blank">
                        <div class="chip">规约</div>
                    </a>
                    
                    
                    
                    <a href="/tags#阶码_cap" target="_blank">
                        <div class="chip">阶码</div>
                    </a>
                    
                </span>
            </div>
        </li>
    </ul>
</div>
<div class="divider"></div>
<div id="post-content" class="row">
    <div class="col s12">
        <h1 id="二进制小数">二进制小数</h1>

<p>谈浮点数前，先了解一些基础知识；对于整数的十进制与二进制转换不难，原理也简单就不再赘述，假如现在要进行转换的十进制数字是带有小数点的，转换方法就会稍微有点不一样了；为了使说明更浅显易懂，先来探究一下十进制小数中的奥秘；</p>

<p>以十进制数 <strong>3.125</strong> 为例，小数点以左为整数部分，右为小数部分，它也可以被更具体的拆解为以下形式：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3x10^0 + 1x10^-1 + 2x10^-2 + 5x10^-3
</code></pre></div></div>

<p>这也是十进制数的特点，基数为 10，所以每一位都是与 10 的相应次方的乘积，指数也是有规律的，可以看成以小数点为对称轴，向左就是 10 的 0、1、2、3……次方递增，向右则是 10 的 -1、-2、-3……次方递减，如果换一种形式，那么在运算方面也具有对称性（乘法与除法互为逆运算），就是下面的形式：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3x10^0 + 1/10 + 2/10^2 + 5/10^3
</code></pre></div></div>

<p>这样，理解二进制的小数部分就容易了，已经知道整数十进制转二进制其实就是连续除以 2 取余数，那么根据上面的规律，小数部分看出逆运算，就可以总结为 <strong>连续乘 2 取整数</strong>，举例说明：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.125（十进制）

3     / 2 = 1    --&gt; 1
         余 1    --&gt; 1
0.125 x 2 = 0.25 --&gt; 0
0.25  x 2 = 0.5  --&gt; 0
0.5   x 2 = 1    --&gt; 1

==&gt; 11.001（二进制）
</code></pre></div></div>

<p><strong>11.001</strong> 就是 3.125 的二进制小数形式，同时它也可以做如下拆解：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1x2^1 + 1x2^0 + 0x2^-1 + 0x2^-2 + 0x2^-3

= 2 + 1 + 0 + 0 + 0.125
= 3.125
</code></pre></div></div>

<p>可以看到也是与十进制形式相对应的，只是基数从 10 换成了 2 而已；</p>

<h1 id="定点数">定点数</h1>

<p>当然，都知道机器码都是一堆 <code class="language-plaintext highlighter-rouge">0</code> 和 <code class="language-plaintext highlighter-rouge">1</code> 组成的数据，并没有小数点这个专门的符号，要表示数字 3125 还好说，但是 3.125 中间多出的这一点要怎么解决呢……一个很直接的方法就是把小数点应该在的位置焊死 -_-，比如 32 位的系统，规定小数点在 16 位和 17 位之间，那么根据 3.125 的二进制是 11.001，在 32 中的表现就是：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0000 0000 0000 0011 0010 0000 0000 0000
</code></pre></div></div>

<p>这就是 <strong>定点数</strong> 的规则干的事情，看着挺好，要是多用几次系统空间可能就 hold 不住了，不好之处明显就是花掉当前一半的数量级取表述小数部分，当然可以少划分几位给小数，但对小数好像不太公平，万一精度要求高呢，反过来呢对整数又不公平了，手心手背都是肉，得想办法解决才行；</p>

<h1 id="浮点数">浮点数</h1>

<p>于是乎，浮点数横空出世；其实上述问题平时肯定都遇到过，比如记个帐，昨日净收入 <code class="language-plaintext highlighter-rouge">31200000000</code> 元（@_@），肯定不想写这一堆 0 对不对（如果是真的咱愿意写 100 遍……），一般都会写 312 亿或者 <code class="language-plaintext highlighter-rouge">3.12x10^10</code> 元，重点就在后面这种科学计数表示法，人为了省力省纸省笔墨弄了个科学计数法，处理器也自然用上了浮点数，省空间；具体原理与表示方法后面会讲；</p>

<p>以 C语言为代表，其中就有浮点这一数据类型，比如单精度浮点 float（32 位），双精度浮点 double（64 位）等，可能平时也就直接声明和使用较多，没太关注底层实现的算法，其实也不太复杂，套用一种规则而已，下面开始介绍；</p>

<h2 id="标准">标准</h2>

<p>目前关于浮点运算与表示，使用广泛的应该就是 IEEE 754（二进制浮点数算术标准）了，其主要内容如下：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>v = (-1)^s * 2^e * m

v: 浮点数具体值
s: 符号位，即正负号，0 为正，1 为负
m: 有效数，也叫尾数，可以类比科学计数法前面的有效数字
   另外还有一个小数位 f, m = 1 + f
e: 指数位，即 2 的多少次方
</code></pre></div></div>

<p>该标准包含了多中位数，以 32 位为例：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(1)   (8)          (23)          : 位数
0 00000011 0010000000000000000000
s e        f
</code></pre></div></div>

<p>总结就是：</p>

<ul>
  <li>第一位为符号位 s；</li>
  <li>后 8 位为指数位 e；</li>
  <li>最后 23 位为小数位 f；</li>
</ul>

<p>64 位的规则是：</p>

<ul>
  <li>第一位是符号位 s；</li>
  <li>后 11 位是指数 e；</li>
  <li>最后 52 位是有效数字 m；</li>
</ul>

<p>知道了这些还不能立刻套用上面的公式经行转换，还需要了解接下来的一些规定；</p>

<h2 id="指数偏移值">指数偏移值</h2>

<p>浮点的二进制表示中指数位 e 的计算值（即转换成十进制后的值），要在实际指数值（十进制）的基础上加上一个 <strong>偏移值</strong>，标准中规定偏移值为 <code class="language-plaintext highlighter-rouge">2^(e-1) - 1</code>，如 32 为中 e 是 8 位，所以偏移值为 127，64 位的就为 1023；所以 32 位指数实际值的范围为 <code class="language-plaintext highlighter-rouge">-126 ~ 127</code>；</p>

<p>举个例，指数 e 的实际值为 -3，那么 32 位中加上偏移值就是 <code class="language-plaintext highlighter-rouge">-3 + 127 = 124</code>，换算成二进制的 8 位指数位就是 <code class="language-plaintext highlighter-rouge">01111100</code>;</p>

<p>这种指数位偏移后的指数值，又叫做 <strong>阶码</strong>，因为科学计数法中的指数是有正负之分的，所以实际指数值加上一个正的适中偏移值，就可以使得浮点表示法中的指数位为无符号的整型（就是变成正整数），利于浮点数的比较大小，就是可以直接从浮点的二进制表示中，由高位向低位逐位进行比较（如果是负数二进制比较大小要复杂一点）。</p>

<h2 id="表示方式">表示方式</h2>

<p>具体的表示方式会根据不同的情况而不同，主要有以下几种情况；</p>

<h3 id="规约形式">规约形式</h3>

<p>即 e 的 8 位数字不是全部为 0 或者 1，此时 <code class="language-plaintext highlighter-rouge">m = 1 + f</code>，由于小数部分 f 的值在 0 到 1 之间，所以有效数 m 的值在 1 到 2 之间；</p>

<h3 id="非规约形式">非规约形式</h3>

<p>这种形式 e 的 8 位全部为 0，小数位 f 值不为 0，用于表示非常接近 0 的数，此时不再是 <code class="language-plaintext highlighter-rouge">m = 1 + f</code>，而是 <code class="language-plaintext highlighter-rouge">m = f</code>，即 m 值在 0 到 1 之间；实际上所有非规约的浮点数比规约浮点数更接近于 0；</p>

<h3 id="零值">零值</h3>

<p>指数位 e 全为 0 的同时，小数部分（f）为 0，用来表示 <code class="language-plaintext highlighter-rouge">±0</code>（正负取决于 s 位的值）；且规定最小指数位编码（e = 0 时）的实际值应该取 <code class="language-plaintext highlighter-rouge">-126</code>（本来应该是 <code class="language-plaintext highlighter-rouge">0 - 127 = -127</code>）；</p>

<h3 id="无穷大">无穷大</h3>

<p>如果 e 全为 1，且 m 全为 0，则表示无穷大（Infinity，正负取决于 s 位的值）；</p>

<h3 id="nan">NaN</h3>

<p>如果 e 全为 1，且 m 不全为 0，则表示 <code class="language-plaintext highlighter-rouge">NaN</code>（Not a Number，非数值类型）；</p>

<h2 id="综合举例">综合举例</h2>

<p>后面的例子都以 32 位为例，其它位数根据标准类推；</p>

<p>先来看一个十进制转浮点，规约形式的例子，比如用之前的十进制数 3.125，转换为 32 位浮点二进制格式（<code class="language-plaintext highlighter-rouge">0b</code> 开头的表示二进制数据）：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>3.125
= 0b11.001
= 0b1.1001 x 2^1

s = 0

e = 1
  =&gt; 1 + 127
  =  128
  =  0b10000000
  
m = ob1.1001
f = m - 1
  = 0b0.1001
  =&gt; 0b10010000000000000000000
  
==&gt;
0 10000000 10010000000000000000000
</code></pre></div></div>

<p>转换的大致流程总结如下：</p>

<p><strong>十进制小数 –&gt; 二进制小数 –&gt; 浮点表示法 –&gt; 二进制浮点</strong></p>

<p>再举一个二进制浮点转十进制小数例子：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 01111111 00100000000000000000000

s = 1
  =&gt; -1
  
e = 0b01111111
  = 127
  =&gt; 127 - 127
  = 0
  
f = 0b0.001
m = 1 + f
  = 0b1.001
  
v = -1 x 0b1.001 x 2^0
  = 0b-1.001
  = -1.125

==&gt; -1.125
</code></pre></div></div>

<h2 id="精度">精度</h2>

<p>以 32 位单精度浮点数为例，由于分配给有效数字的位数是 23 位，而整数部分默认是 1，它的位置就不用留了，所以小数部分就可以独占 23 位，在加上默认的一个整数位就是 24 位了，同理，64 位双精度浮点数的有效数就是 53 位（52+1），再进行一下算术运算：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log(2^24) = 7.22
log(2^53) = 15.95
</code></pre></div></div>

<p>上面的算式表示二进制下的这么多位数的实际值，对应到十进制中有多少位；结果表明，单精度浮点可以保证 7 位十进制的有效数字，双精度的则可以保证 15 位；</p>

<h2 id="浮的原因">“浮”的原因</h2>

<p>取名为浮点，那么到底“浮”在了什么地方，与定点数相比的优势又是什么？总的看来，其实其转换操作很类似于十进制中的科学计数法，而科学计数法的出现，就是为了实现能简短地书写较大的数，比如写作 <code class="language-plaintext highlighter-rouge">1.0x10^20</code>，就可以避免在 1 后面写那令人抓狂的 20 个 0 了；</p>

<p>同理，二进制中如果用定点数表示小数，那么 32 位的话就最多到 32 位有效数字，而用这种类似科学技术的浮点表示法的话，指数能表示到 100 以上，也就是 100 多位了，相信现在的 100 位系统也是稀有物种了吧；因此，浮点数有效的扩大了能表示的数据范围，科学计数法减少了书写量，浮点表示则是节省了存储空间；</p>

<p>另外也是由于科学计数本身的特性，以及指数偏移值，也就是 <strong>阶码</strong> 的应用，小数点也就不再像之前一样固定，具体位置会根据指数的大小最终“漂浮”到不同的位置，甚至到那遥远的地方……</p>

    </div>
</div>
<hr>

<!-- valine 评论插件 -->
<h3>评论：</h3>
<div class="comments"></div>
<hr>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
    new Valine({
        el: '.comments',
        appId: '4XY3DoTJmibNe3rHeAKOxqzl-gzGzoHsz',
        appKey: 'vjothQHALvgTQF9GrSgj577a',
        avatar: 'robohash',
        placeholder: '留下你的评论吧（支持Markdown）~',
        // visitor: true,
    })
</script>

<!-- 微信公众号 -->
<div class="program-knight">
    <p>技术文章推送</p>
    <p>手机、电脑实用软件分享</p>
    <img src="/assets/img/knight.png" alt="微信搜索公众号: 程序骑士" title="微信搜索公众号: 程序骑士">
    <div>
        <img src="/assets/img/wechat.png" alt="wechat">
        <b>微信公众号：程序骑士</b>
    </div>
</div>
<!--百度资源自动提交-->


    </div>
</div>

</main>

<footer class="page-footer teal">
    <div class="container">
        <div class="row">
            <div class="col s12">
                <p class="footer-message grey-text text-lighten-3">以勤劳的双手，用心敲写明天</p>
                <hr>
                <p class="visit-statistics">
                    <span id="busuanzi_container_site_pv">访问量：<span id="busuanzi_value_site_pv"></span>次</span>&nbsp;
                    <span id="busuanzi_container_site_pv">访客量：<span id="busuanzi_value_site_uv"></span>人次</span>
                </p>
                <p class="grey-text text-lighten-4">基于 jekyll 的 Github Pages 个人博客网站
</p>
            </div>
        </div>
    </div>
    <div class="footer-copyright">
        <div class="container">
            Copyright &#xA9; 2021 苏梓鑫的博客. All rights reserved. Powered by
            <a href=https://github.com/suzixin/suzixin.github.io>knightyun</a>.
        </div>
    </div>
    <!-- Search box -->
    <div class="search">
        <i class="material-icons search-icon search-start">search</i>
        <input type="text" class="search-input" placeholder="Searching...（支持正则表达式）" />
        <i class="material-icons search-icon search-clear">clear</i>
        <div class="search-results z-depth-4"></div>
    </div>
    <!-- 右下角功能按钮 -->
    <div class="fixed-action-btn">
        <a class="btn-floating btn-large blue z-depth-4">
            <i class="large material-icons">apps</i>
        </a>
        <ul>
            <li class="category-btn hide">
                <!-- 文章目录按钮 -->
                <a class="sidenav-trigger btn-floating blue lighten-2" data-target="category">
                    <i class="material-icons">format_list_bulleted</i>
                </a>
            </li>
            <li>
                <a class="btn-floating blue lighten-2" href="javascript: searchInput.focus()">
                    <i class="material-icons">search</i>
                </a>
            </li>
            <li>
                <a class="btn-floating blue lighten-2" href="javascript: scrollTo(0, 0);">
                    <i class="material-icons">publish</i>
                </a>
            </li>
            <li>
                <a class="btn-floating blue lighten-2" href="javascript: scrollTo(0, document.body.clientHeight);">
                    <i class="material-icons">file_download</i>
                </a>
            </li>
        </ul>
    </div>
    <!-- 文章目录侧栏 -->
    <ul id="category" class="hide sidenav no-autoinit grey lighten-4 grey-text text-darken-3">
        <li>
            <p class="center-align">目录</p>
        </li>
    </ul>
</footer>


    
    <script src="/assets/js/min/materialize.min.js"></script>
    

    
    <script src="/assets/js/min/post.min.js"></script>
    

    
    <script src="/assets/js/min/particles.min.js"></script>
    

    
    <script src="/assets/js/min/main.min.js"></script>
    

    
    <script src="/assets/js/min/search.min.js"></script>
    

    
    <script src="/assets/js/min/gen-category.min.js"></script>
    




<!-- 以下为插入的第三方网站分析代码 -->

</body>

</html>